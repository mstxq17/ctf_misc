<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 7.1.1 (456642)"/><meta name="altitude" content="50.7026572266"/><meta name="author" content="154380808@qq.com"/><meta name="created" content="2018-08-23 05:22:28 +0000"/><meta name="latitude" content="22.9012212227936"/><meta name="longitude" content="112.5828996410785"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2018-08-24 10:40:29 +0000"/><title>MISC之wireshark入门学习</title></head><body><div>1.wireshark定义</div><div>    前称(ethereal) 是一个网络封包分析软件</div><div>2.工作原理</div><div>    wireshark使用winPCAP作为接口,直接与网卡进行数据报文交换</div><div>    通俗解释:<span style="font-size: 14.6667px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">电工技师使用电表来量测电流、电压、电阻" 的工作 - 只是将场景移植到网络上，并将电线替换成网络线</span></div><div><span style="font-size: 14.6667px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">3.更多了解 参考博客:<a href="https://blog.csdn.net/sinat_32176267/article/details/78297361" style="font-size: 14.6667px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51);">https://blog.csdn.net/sinat_32176267/article/details/78297361</a></span></div><div><br/></div><div>界面:Mac wireshark 2.4.3 </div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/F12D7B2E-EDB8-4AD0-9701-DA733ACD7FED.png" height="1262" width="1922"/><br/></div><div><br/></div><div>关于功能模块 在讲解协议的时候在分析:</div><div><br/></div><div>认识关键点:</div><div>    <img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/22CA63BA-2AFE-4EBB-862D-08E7D37E3707.png" height="262" width="1544"/><br/></div><div><br/></div><div>了解封包详细信息(Packert Details Pane)的内容</div><div><br/></div><div>1.Frame:物理层数据帧概况</div><div>2.Ethernet II:数据链路层以太网帧头部信息</div><div>3.Internet Protocol Version 4:网络层互联网IP包头部信息</div><div>4.Transmission Control Protocol:传输层T的数据段头部信息</div><div>5.Hypertext Transfer Protocol:应用层信息</div><div>6.HTML… 属于应用层内容</div><div><br/></div><div>详细了解OSI七层模型: <a href="https://zh.wikipedia.org/wiki/OSI%E6%A8%A1%E5%9E%8B">https://zh.wikipedia.org/wiki/OSI%E6%A8%A1%E5%9E%8B</a></div><div>学习重点:</div><ol><li><div>关系最明显的应用层:</div></li></ol><div><span style="font-size: 15.008px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(34, 34, 34); font-family: sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">          提供为应用软件而设的接口，以设置与另一应用软件之间的通信。例如: HTTP，HTTPS，FTP，TELNET，SSH，           SMTP，POP3等</span></div><ol start="2"><li><div><span style="color: rgb(34, 34, 34); font-family: sans-serif;">传输层</span></div></li></ol><div><span style="font-size: 15.008px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(34, 34, 34); font-family: sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">            传输层（Transport Layer）把传输表头（TH）加至数据以形成数据包。传输表头包含了所使用的协议等发送信息。例如:传输控制协议（TCP）等。</span></div><div><br/></div><div><br/></div><div><font style="font-size: 18px;"><span style="color: rgb(34, 34, 34); font-family: sans-serif; font-size: 18px; font-weight: bold;">(一)TCP协议入门</span></font></div><div><br/></div><div><span style="caret-color: rgb(34, 34, 34); color: rgb(34, 34, 34); font-family: sans-serif;">wireshark背景知识:</span></div><div><span style="caret-color: rgb(34, 34, 34); color: rgb(34, 34, 34); font-family: sans-serif;">传输层相关:</span></div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/1A678549-A851-4448-9711-B38FA21DC76F.png" height="576" width="1852"/><br/></div><div>上面显示的是tcp协议</div><div>所以上面内容对应tcp报文格式: </div><div>学习连接:<a href="https://jerryc8080.gitbooks.io/understand-tcp-and-udp/chapter2.html">https://jerryc8080.gitbooks.io/understand-tcp-and-udp/chapter2.html</a></div><div><br/></div><div>source port:源端口号</div><div>Destination port:目标端口号</div><div>sequence number:序号</div><div>acknowledgment:确认号</div><div>hader length:探头长度</div><div>Flags:标志位</div><div>window size value:窗口</div><div>checksum:校验和</div><div>具体了解上述作用可以参考连接  建议先熟悉这个概念 然后再去深究 所以继续看下去先 回头再去研究</div><div><br/></div><div><span style="font-weight: bold;">认识tcp三次握手过程:</span></div><div> <img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/A5476EF2-D549-4D2C-9D5E-A76D2F7C8B02.png" height="744" width="1354"/><br/></div><div><br/></div><div>                                       </div><div>类比qq聊天: 日期:x 软件qq </div><div> wo:在吗(syn=1),你收到的是我今天的第x条信息(seq=x) (x的计算方式是全部信息内容一个字节从0 1 2 3 x x+1)</div><div>女神:在(syn=1)),我知道了(ack=x+1),你收到的是我今天的第y条信息(seq=y)</div><div>我:哦，我知道了(ack=y+1),你收到的是我今天的第z条信息(seq=z)          x.y.z的关系实战抓包看看变化</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/F2B85529-6054-4419-BA58-B96CBA006FC0.png" height="80" width="1858"/><br/></div><div>我的IP地址:172.28.177.130</div><div>女神的ip地址:223.111.209.196</div><div><br/></div><div>第一次握手:</div><div>我给女神发送tcp请求连接报文段 代表要建立tcp连接</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/02380F06-743E-4039-AE59-4C72058770A6.png" height="656" width="1906"/><br/></div><div>seq=0 syn=1</div><div>第二次握手:</div><div>    <img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/B1A2879A-D1AF-4F78-8186-99E8D19F2365.png" height="482" width="1372"/><br/></div><div><br/></div><div>ack的set位置代码ACK number是有效的 之后tcp连接这里都会为1</div><div>seq=0 ack=0+1=1 syn=1</div><div><br/></div><div>第三次握手:</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/AFB57C61-C75C-4110-8AA3-8FB0DB3EA0B3.png" height="582" width="1344"/><br/></div><div><br/></div><div>seq=0+1=1 ACK=y+1=0+1=1</div><div><br/></div><div>由此就可以知道了 seq 显示在左边的是相对值 绝对值是随机一个大值,是自己增加+1  ack是根据对方的seq进行+1  sck是用来确认报文的 seq代表的数据分组之后第一个字节序号 </div><div>不理解参考:<a href="https://jerryc8080.gitbooks.io/understand-tcp-and-udp/chapter2.html">https://jerryc8080.gitbooks.io/understand-tcp-and-udp/chapter2.html</a></div><div><br/></div><div><span style="font-weight: bold;">(2)认识TCP连接的数据传输过程:</span></div><div>PUSH(PSH)标志位置1 意味着数据的传输 </div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/99D78532-0E48-43FA-BA66-6E52EEC2B987.png" height="108" width="556"/><br/></div><div><br/></div><div>这个就是数据包包含的数据</div><div><span style="font-weight: bold;">(3)认识TCP连接的断开过程</span></div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/75A489EF-A727-43A5-8AA9-80958C97F9A3.png" height="794" width="1262"/><br/></div><div><br/></div><div>不同的地方是涉及到了FIN标志位 然后多了次握手的过程</div><div>我:要走了哦 fin=1</div><div>女神回复:走吧</div><div>女神:那我也走了 fin=1</div><div>我:好的</div><div><br/></div><div>seq 和ack的变化规律和上面一样</div><div><br/></div><div><br/></div><div><font style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">(二)DNS的认识</span></font></div><div>dns概念:</div><div>(DNS Name System)域名系统 作为 Internet的一个重要组成部分 是网络协议中比较常见的一种协议</div><div>DNS采用53端口基于udp协议 </div><div>数据量大的时候采用tcp协议</div><div>作用: 把域名解析到ip地址 或者实现不同域名的跳转等等 </div><div><br/></div><div>(1)了解DNS协议</div><div>相关知识链接:<a href="https://jocent.me/2017/06/18/dns-protocol-principle.html">https://jocent.me/2017/06/18/dns-protocol-principle.html</a></div><div><br/></div><div>域名解析过程:</div><div> <img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/15F402BC-C579-4119-9ECB-E8D0C3420093.png" height="340" width="1816"/><br/></div><div><br/></div><div>主机A:172.28.177.130 本地域名服务器:222.246.129.80</div><div>流程: 观察可知 在进行递归查询 不断向上层查询</div><div><br/></div><ol style="box-sizing: border-box; font-size: 18px; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); list-style-type: upper-alpha;"><li style="box-sizing: border-box;"><div><span style="color: rgb(0, 0, 0); font-family: lora, serif; font-size: 18px; font-variant-caps: normal; font-variant-ligatures: normal;">主机A先向本地域名服务器B进行</span><span style="box-sizing: border-box; color: rgb(0, 0, 0); font-family: lora, serif; font-size: 18px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">递归查询</span></div></li><li style="box-sizing: border-box;"><div><span style="color: rgb(0, 0, 0); font-family: lora, serif; font-size: 18px; font-variant-caps: normal; font-variant-ligatures: normal;">本地域名服务器采用</span><span style="box-sizing: border-box; color: rgb(0, 0, 0); font-family: lora, serif; font-size: 18px; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">迭代查询</span><span style="color: rgb(0, 0, 0); font-family: lora, serif; font-size: 18px; font-variant-caps: normal; font-variant-ligatures: normal;">，向一个根域名服务器进行查询</span></div></li><li style="box-sizing: border-box;"><div><span style="color: rgb(0, 0, 0); font-family: lora, serif; font-size: 18px; font-variant-caps: normal; font-variant-ligatures: normal;">根域名服务器告诉本地域名服务器，下一次应该查询的顶级域名服务器</span><span style="box-sizing: border-box; font-size: 16.2px; background-color: rgb(238, 238, 238); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; color: rgb(14, 148, 236); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: initial initial; background-repeat: initial initial;"> </span><a href="http://dns.me" style="box-sizing: border-box; font-size: 16.2px; background-color: rgb(238, 238, 238); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(14, 148, 236); background-position: initial initial; background-repeat: initial initial;">dns.me</a><span style="color: rgb(0, 0, 0); font-family: lora, serif; font-size: 18px; font-variant-caps: normal; font-variant-ligatures: normal;">的IP地址</span></div></li><li style="box-sizing: border-box;"><div><span style="color: rgb(0, 0, 0); font-family: lora, serif; font-size: 18px; font-variant-caps: normal; font-variant-ligatures: normal;">本地域名服务器向顶级域名服务器 </span><span style="box-sizing: border-box; font-size: 16.2px; background-color: rgb(238, 238, 238); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; color: rgb(14, 148, 236); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: initial initial; background-repeat: initial initial;">dns.</span><span style="box-sizing: border-box; font-size: 13px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(233, 235, 236); color: rgb(34, 34, 34); font-family: Monaco, Consolas, &quot;Andale Mono&quot;, &quot;DejaVu Sans Mono&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: normal; background-position: initial initial; background-repeat: initial initial;">me</span><span style="color: rgb(0, 0, 0); font-family: lora, serif; font-size: 18px; font-variant-caps: normal; font-variant-ligatures: normal;">进行查询</span></div></li><li style="box-sizing: border-box;"><div><span style="color: rgb(0, 0, 0); font-family: lora, serif; font-size: 18px; font-variant-caps: normal; font-variant-ligatures: normal;">顶级域名服务器</span><span style="box-sizing: border-box; font-size: 16.2px; background-color: rgb(238, 238, 238); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; color: rgb(14, 148, 236); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: initial initial; background-repeat: initial initial;">me</span><span style="color: rgb(0, 0, 0); font-family: lora, serif; font-size: 18px; font-variant-caps: normal; font-variant-ligatures: normal;">告诉本地域名服务器，下一步查询权限服务器</span><a href="http://dns.jocent.me" style="box-sizing: border-box; font-size: 16.2px; background-color: rgb(238, 238, 238); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(14, 148, 236); background-position: initial initial; background-repeat: initial initial;">dns.jocent.me</a><span style="color: rgb(0, 0, 0); font-family: lora, serif; font-size: 18px; font-variant-caps: normal; font-variant-ligatures: normal;"> 的IP地址</span></div></li><li style="box-sizing: border-box;"><div><span style="color: rgb(0, 0, 0); font-family: lora, serif; font-size: 18px; font-variant-caps: normal; font-variant-ligatures: normal;">本地域名服务器向权限服务器 </span><a href="http://dns.jocent.me" style="box-sizing: border-box; font-size: 16.2px; background-color: rgb(238, 238, 238); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(14, 148, 236); background-position: initial initial; background-repeat: initial initial;">dns.jocent.me</a><span style="color: rgb(0, 0, 0); font-family: lora, serif; font-size: 18px; font-variant-caps: normal; font-variant-ligatures: normal;">进行查询</span></div></li><li style="box-sizing: border-box;"><div><span style="color: rgb(0, 0, 0); font-family: lora, serif; font-size: 18px; font-variant-caps: normal; font-variant-ligatures: normal;">权限服务器 </span><a href="http://dns.jocent.me" style="box-sizing: border-box; font-size: 16.2px; background-color: rgb(238, 238, 238); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(14, 148, 236); background-position: initial initial; background-repeat: initial initial;">dns.jocent.me</a><span style="color: rgb(0, 0, 0); font-family: lora, serif; font-size: 18px; font-variant-caps: normal; font-variant-ligatures: normal;">告诉本地域名服务器所查询的主机的IP地址</span></div></li><li style="box-sizing: border-box;"><div><span style="color: rgb(0, 0, 0); font-family: lora, serif; font-size: 18px; font-variant-caps: normal; font-variant-ligatures: normal;">本地域名服务器最后把查询结果告诉 A</span></div></li></ol><div><span style="font-size: 18px; font-family: lora;">了解递归查询和迭代查询的区别:</span></div><ul><li><div><span style="font-family: lora;">递归查询:本机向本地域名服务器发出一次查询请求,就静待最终结果</span></div></li><li><div>迭代查询:本地域名服务器一边询问一边得到的下一步的域名服务器地址去访问</div></li></ul><div><br/></div><div>DNS协议报文格式:</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/A8EC3E0B-4ECA-49D1-B258-19D6C1C560DD.png" height="408" width="875"/><br/></div><div>DNS正文字段学习:<img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/B8789659-0354-418E-AB39-D4CEFAADCFC6.png" height="296" width="1206"/><br/></div><div><br/></div><div>需要了解:</div><div>type:DNS记录类型 </div><div>常用:A:A记录</div><div>        NS:指向ipv4地址 或者别名</div><div>        MX:邮件交换</div><div>        CNAME:别名 查询规范名称</div><div>        AAAA:ipV地址解析</div><div>        txt:为某个主机名或域名设置的说明</div><div>        PTR:指针记录,PTR记录是A记录的逆向记录</div><div>        SOA:标记一个区的开始,起始授权机构的记录</div><div><br/></div><div>实战分析 数据包下载地址:<a href="https://xz.aliyun.com/forum/upload/affix/20180116001559-5faec9da-fa0f-1.zip">https://xz.aliyun.com/forum/upload/affix/20180116001559-5faec9da-fa0f-1.zip</a></div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/32B000F7-351B-4F30-AA8A-478F112EE3E9.png" height="1102" width="1998"/>查询sudalover.cn的dns A类型记录 然后第二行返回了</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/AD06994B-5724-490B-9886-E63D9DAD4E1C.png" height="1006" width="1878"/><br/></div><div>别名地址,然后cdn域名在解析到ip地址.</div><div>为啥会返回cname 是因为A记录没有指向ipv地址所以就会去指向别名</div><div><br/></div><div>TXT记录:</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/72AB551B-0CC7-4462-AD89-D0B2597F8C5F.png" height="372" width="1964"/><br/></div><div>TXT:可以用来隐藏一些信息 </div><div><br/></div><div>MX记录:用于邮件交换,查询目标域名的nx记录可以得知对方域名邮件服务器的指向 获取ip</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/2C0EB8B7-6777-4BB2-B831-4597BDEC50E5.png" height="958" width="1460"/><br/></div><div>可知目标把自身的mx记录解析到了腾讯 这里是授权区域</div><div><br/></div><div>这类协议考点原理:</div><div><span style="letter-spacing: 0.75px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, system-ui, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 14px;">DNS协议查询和应答字段往往会传输大量的数据，所以可以用于隐藏数据。在常见的CTF和网络安全的实际应用中，往往会出现DNS夹杂数据的情况出现。</span></span></div><div>Ps小知识点: window 下 ipconfig/flushdns 清空缓存   ipconfig /displaydns 查看缓存内容 nslookup 用来查看域名对应的ip地址</div><div><br/></div><div><font style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">(三)HTTP协议认识</span></font></div><div><span style="font-weight: bold;">   </span> 1.http协议概念</div><div>        <span style="font-size: 15px; letter-spacing: 0.75px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, system-ui, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">HTTP协议即超文本传输协议，由TCP承载，实际上是基于TCP建立的可靠连接，进行数据传递</span></div><div><span style="caret-color: rgb(51, 51, 51); color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;">了解知识点:</span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;">(1) http基于tcp wireshark 查看标志位发现带有tcp的psh标志位</span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;">(2)Hypertext Tranfer Protocol 打开这里的分组详情 便是http请求的内容</span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;">(3)一些状态码 比如301 404之类 然后wireshark简单分析下就知道了 301多了lacatio:url 然后下一个数据包请求url</span></div><div><span style="caret-color: rgb(51, 51, 51); color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;">重点:HTTP信息提取</span></div><div><span style="caret-color: rgb(51, 51, 51); color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;">实战数据包下载:<a href="https://xz.aliyun.com/forum/upload/affix/20180117232325-5c5e0f02-fb9a-1.zip" style="font-family: &quot;Monospaced Number&quot;; color: rgb(51, 51, 51);">https://xz.aliyun.com/forum/upload/affix/20180117232325-5c5e0f02-fb9a-1.zip</a></span></div><div><br/></div><div><span style="caret-color: rgb(51, 51, 51); color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;">网页提取:</span></div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/07FF5C4D-A273-4366-9A01-B824E76A4F18.png" height="1278" width="1770"/><br/></div><div><br/></div><div>编号14 右键点击导出分组字节流 保存为html格式即可</div><div><br/></div><div>图片提取:</div><div><br/></div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/94753367-DFB4-40A3-8F1B-05648119D852.png" height="944" width="1706"/><br/></div><div><br/></div><div><br/></div><div><span style="caret-color: rgb(51, 51, 51); color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;">15是请求包 19是返回包 </span></div><div><span style="caret-color: rgb(51, 51, 51); color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;">返回包的JPEG FILE Interchange Format 右键导出分组字节流 保存为jpg格式</span></div><div><br/></div><div><br/></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;; font-weight: bold; font-size: 18px;">(四)认识HTTPS</span></div><div><br/></div><div><span style="caret-color: rgb(51, 51, 51); color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;">学习背景: </span></div><div><span style="caret-color: rgb(51, 51, 51); color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;">    SSL(Secure Socket Layer)安全套接字层协议  TLS(Transport Layer Security) 传输层安全协议</span></div><div><span style="caret-color: rgb(51, 51, 51); color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;">SSL/TLS是保护计算机网络通讯安全的一类加密协议,它们在传输层给原先非安全的应用层协议提供加密保护</span></div><div><span style="caret-color: rgb(51, 51, 51); color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;">如非安全的HTTP协议即可被SSL/TLS保护形成安全的HTTPS协议</span></div><div><br/></div><div><span style="caret-color: rgb(51, 51, 51); color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;">(1)解密HTTPS流量</span></div><div><span style="caret-color: rgb(51, 51, 51); color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;">实战数据包:<a href="https://xz.aliyun.com/forum/upload/affix/20180118230129-76ae090e-fc60-1.zip" style="font-family: &quot;Monospaced Number&quot;; color: rgb(51, 51, 51);">https://xz.aliyun.com/forum/upload/affix/20180118230129-76ae090e-fc60-1.zip</a></span></div><div><br/></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;"> 本机抓取https流量:</span></div><div><span style="caret-color: rgb(51, 51, 51); color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;">操作参考链接:<a href="http://joji.me/zh-cn/blog/walkthrough-decrypt-ssl-tls-traffic-https-and-http2-in-wireshark" style="font-family: &quot;Monospaced Number&quot;; color: rgb(51, 51, 51);">http://joji.me/zh-cn/blog/walkthrough-decrypt-ssl-tls-traffic-https-and-http2-in-wireshark</a></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;"> 配置环境变量:</span></div><div><span style="caret-color: rgb(51, 51, 51); color: rgb(51, 51, 51); font-family: &quot;Monospaced Number&quot;;">不同系统参考链接:<a href="http://joji.me/zh-cn/blog/walkthrough-decrypt-ssl-tls-traffic-https-and-http2-in-wireshark" style="font-family: &quot;Monospaced Number&quot;; color: rgb(51, 51, 51);">http://joji.me/zh-cn/blog/walkthrough-decrypt-ssl-tls-traffic-https-and-http2-in-wireshark</a></span></div><div><span style="font-family: &quot;Monospaced Number&quot;;">我参考的链接:</span><a href="http://www.cnblogs.com/rainmote/p/8320369.html" style="font-family: &quot;Monospaced Number&quot;;">http://www.cnblogs.com/rainmote/p/8320369.html</a><span style="font-family: &quot;Monospaced Number&quot;;"> Mac环境</span></div><div style="orphans: 2; widows: 2; "><span style="caret-color: rgb(102, 102, 102); white-space: pre-wrap; background-color: rgb(245, 245, 245); color: rgb(102, 102, 102); font-family: &quot;Courier New&quot;, sans-serif;">运行chrome并指定sslkey logfile</span></div><div><span style="font-size: 12px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245); color: rgb(102, 102, 102); font-family: &quot;Courier New&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">sudo</span><span style="font-family: &quot;Monospaced Number&quot;;" /><span style="font-size: 12px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(102, 102, 102); font-family: &quot;Courier New&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">/Applications/</span><span style="font-size: 12px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245); color: rgb(102, 102, 102); font-family: &quot;Courier New&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Google\ Chrome.app</span><span style="font-size: 12px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(102, 102, 102); font-family: &quot;Courier New&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">/Contents/</span><span style="font-size: 12px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245); color: rgb(102, 102, 102); font-family: &quot;Courier New&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">MacOS</span><span style="font-size: 12px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(102, 102, 102); font-family: &quot;Courier New&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">/Google\ Chrome --ssl-key-log-file=/</span><span style="font-size: 12px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245); color: rgb(102, 102, 102); font-family: &quot;Courier New&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Users</span><span style="font-size: 12px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(102, 102, 102); font-family: &quot;Courier New&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">/`whoami`/</span><span style="font-size: 12px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245); color: rgb(102, 102, 102); font-family: &quot;Courier New&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">sslkeylog.log</span></div><div><br/></div><div>接下来 在wireshark 通过编辑-首选项-协议(protocols)-SSL-(pre)-Master-Secret log filename(老版)</div><div>在Mac 是</div><div>在分组详情空白处直接右键 </div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/69D3373D-7D0C-4C2C-807E-CA57809240DF.png" height="188" width="1330"/><br/></div><div>选择OPen  -preferences </div><div>在protocols协议展开那里找到SSL</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/FFAAE3FE-8469-4694-9433-091FB0B6190F.png" height="676" width="1618"/><br/></div><div><br/></div><div>配置成功后返回tcp流 </div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/0CA0B8F2-9EAC-4608-963C-B52272399228.png" height="818" width="1754"/><br/></div><div>会发现分组详情多了http字段的信息 分组字节流也出现解密之后的ssl数据(Decrypted SSL Data)</div><div><br/></div><div>(2)服务端私钥解密</div><div>一般题目都会给出ssl的私钥文件</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/9D68BB25-048E-40E8-B109-9704BF142A13.png" height="432" width="1404"/><br/></div><div><br/></div><div>导入私钥 password位保存私钥时指定的加密密码 为了防止私钥丢失被解开</div><div><br/></div><div><br/></div><div><font style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">(五)认识FTP</span></font></div><div><span style="font-size: 14px;">FTP概念:FTP(File Transfer Protocol) 文件传输协议 常用于互联网上对文件的操作 方便用户上传和下载</span></div><div>并对服务器的文件进行操作。用户通过一个支持ftp协议的客户端程序 链接在远程主机上的ftp服务器通过客户端程序向服务端发出命令</div><div>服务端执行用户所发出的命令 并将执行的结果返回到客户端</div><div><br/></div><div>(1)了解ftp的认证过程</div><div>实战数据包:<a href="https://xz.aliyun.com/forum/upload/affix/20180119142138-01bb1566-fce1-1.zip">https://xz.aliyun.com/forum/upload/affix/20180119142138-01bb1566-fce1-1.zip</a></div><div>重点: </div><div>wireshark 把带有FTP控制信息的解析协议为FTP </div><div>传输文件内容或者命令执行结果的ftp数据包解析为FTP-DATA</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/6DE31297-8488-4A6E-82A8-86CD69410DBC.png" height="392" width="1832"/><br/></div><div>先三次握手建立tcp连接 也就是建立了ftp链接 (说明ftp协议也是基于tcp协议的)</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/213B2FA6-3470-467D-8928-5A994EA512D8.png" height="724" width="1834"/><br/></div><div>查看数据包分组详情:</div><div>ftp返回码220 ftp服务做好了用户登录的准备 </div><div>接着是ftp server的banner welcome to…</div><div>还有一些端口信息</div><div><br/></div><div>序号6</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/92C1076C-B4C2-4CBB-85D0-C7659433FA6F.png" height="568" width="1792"/><br/></div><div>客户端向服务器发送了 USER ftp 的命令 ftp命令格式: command arg 对应前面 USER ftp </div><div>意思是使用用户名ftp登陆这台服务器 </div><div>服务端返回码331要求密码</div><div>接着客户端同理发送密码</div><div><br/></div><div>注释ftp小特点:</div><div>ftp 服务不论这个用户存在与否都会要求输入密码</div><div><br/></div><div>发送密码后认证成功 ftp 返回码230 返回当前目录</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/DF256B42-94C4-4694-94B6-BA097A9E726A.png" height="440" width="1778"/><br/></div><div>序号18:客户端给服务端发送PORT命令 指定客户端一个端口 随后服务端主动链接该端口 用于传输数据</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/DD3024EE-0AFF-43EF-92B2-9E557E24B406.png" height="272" width="846"/><br/></div><div><br/></div><div>端口是54529</div><div><br/></div><div>25:</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/745BEA32-93FB-4603-94BB-E5D63C0FE402.png" height="396" width="1686"/><br/></div><div>26:向客户端指定端口发送根目录下内容信息</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/528E69AA-9208-4AAC-A572-11BA9CB63DFF.png" height="850" width="1524"/><br/></div><div><br/></div><div>29:服务器主动发送226 表示关闭数据传输</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/88ED510D-7667-48B3-B176-383A1BC1D0E2.png" height="228" width="964"/><br/></div><div><br/></div><div>上面就是一些命令和ftp操作的演示</div><div><span style="font-weight: bold;">接下来讲讲怎么从流量中提取压缩包:</span></div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/86BEA973-4C87-4756-B077-B16991D2DB52.png" height="544" width="1834"/></div><div><br/></div><div>可以看到序号57客户端发送PETR 去请求ftp服务器一个压缩包</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/C0C611B6-A419-45F6-9D8F-75380CEDE54C.png" height="936" width="1780"/></div><div><br/></div><div>61链接客户端开的数传输端口</div><div>62是传输的数据 </div><div>查看分组详情导出分组字节流保存为tgz压缩格式即可</div><div><br/></div><div><font style="font-size: 18px;"><b>(六)认识无线wifi协议</b></font></div><div>实战数据包地址:<a href="https://xz.aliyun.com/forum/upload/affix/20180120225740-430b70a8-fdf2-1.zip">https://xz.aliyun.com/forum/upload/affix/20180120225740-430b70a8-fdf2-1.zip</a></div><div>参考链接:<a href="http://www.cnblogs.com/LittleHann/p/3700357.html">http://www.cnblogs.com/LittleHann/p/3700357.html</a></div><div>wifi链接过程:</div><div>1.选择口令</div><div>2.口令 pskyingshe</div><div>3.生成主密钥</div><div>4.4次握手</div><div><br/></div><div>1.AP发送Beacon广播管理帧</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/721DE695-14E0-4F8B-B328-B63B818EEA8F.png" height="300" width="1014"/></div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/6D079713-E3C7-4E43-BDB6-0A9DE64D6223.png" height="508" width="1092"/></div><div><br/></div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/516DEAAB-C170-41A4-9536-2784AE22ABF0.png" height="80" width="898"/></div><div>全地址广播 我们内置网卡会收到信号 就会在我们电脑的无线连接列表显示ap</div><div><br/></div><div>解释下洪水攻击的原理(Deauthentication Attack):</div><div>——————暂时没必要研究------------</div><div><br/></div><div>掌握无线数据包的解密:</div><div>前提:</div><div>SSID </div><div>无线密码</div><div>在<a href="https://www.wireshark.org/tools/wpa-psk.html">https://www.wireshark.org/tools/wpa-psk.html</a>生成psk</div><div>然后在协议-ieee802.111-Decryption Keys导入即可</div><div>然后重新打开或者重新载入这个数据包就可以看到解密后的流量</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>(七)wireshark应用场景分析</div><div>(1)wireshark的统计功能</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/524ADA66-C1AB-4F1A-B15C-5F9CF7E138F0.png" height="352" width="552"/><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/4341DC6F-4E77-4E95-87FE-6217A5AA76F0.png" height="260" width="1488"/></div><div>(2)过滤器的应用</div><div> 获取ftp登陆成功的包 ftp.response.code==230</div><div> 过滤暴力破解ftp包: ftp.request.command==“PASS” 然后通过统计 捕获文件属性-统计</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/C0CA1790-A1C6-4156-B25E-589A0CB15DFD.png" height="454" width="1224"/></div><div>查看分组数也就是条数</div><div>(3)分析端口扫描</div><div>数据包:<a href="https://xz.aliyun.com/forum/upload/affix/20180122223028-cadb57ac-ff80-1.zip">https://xz.aliyun.com/forum/upload/affix/20180122223028-cadb57ac-ff80-1.zip</a></div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/0DE9A32D-82FD-4D9F-BAB7-65BEE3271507.png" height="348" width="1566"/></div><div><br/></div><div>看到大量192.168.233.128发给192.168.233.131的syn报文</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/6399CEF7-CF08-49EA-B347-8019BA0EB739.png" height="230" width="2214"/></div><div>这里可以看到ack确认过程得知 21 22 80 端口成功建立了tcp连接 意味着端口开发</div><div><br/></div><div>过滤器的应用</div><div>(1)分组详情右键 作为过滤器应用</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/D7B52ACD-72A8-4A99-BE4E-6424D061B103.png" height="372" width="1434"/></div><div><br/></div><div>tcp.srcport == 63631</div><div><br/></div><div>(2)使用filter表达式</div><div><img src="MISC%E4%B9%8Bwireshark%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.resources/C3CE9EED-23FC-4D66-8B53-28CA7DA615E0.png" height="372" width="1414"/>\</div><div><br/></div><div><br/></div><div><br/></div></body></html>
